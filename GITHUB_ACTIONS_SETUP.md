# GitHub Actions ?먮룞諛고룷 ?ㅼ젙 媛?대뱶

## ?뱥 媛쒖슂
`main` 釉뚮옖移섏뿉 肄붾뱶瑜??몄떆?섎㈃ ?먮룞?쇰줈 EC2 ?쒕쾭??諛고룷?⑸땲??

**諛고룷 ?꾨줈?몄뒪:**
1. GitHub??肄붾뱶 push
2. GitHub Actions ?ㅽ뻾
3. EC2??SSH ?묒냽
4. `git pull` ??`npm install` ??`npm run build` ??`pm2 restart dlive`

---

## ?뵍 1?④퀎: GitHub Secrets ?ㅼ젙

GitHub 由ы룷吏?좊━??誘쇨컧???뺣낫瑜??덉쟾?섍쾶 ??ν빐???⑸땲??

### 1-1. GitHub 由ы룷吏?좊━ ?ㅼ젙 ?섏씠吏濡??대룞

```
https://github.com/Jusang98/DLive-cona-front/settings/secrets/actions
```

?먮뒗:
1. GitHub 由ы룷吏?좊━ ?섏씠吏 ?묒냽
2. **Settings** ???대┃
3. ?쇱そ 硫붾돱?먯꽌 **Secrets and variables** ??**Actions** ?대┃

### 1-2. ?ㅼ쓬 3媛쒖쓽 Secret 異붽?

#### ??`EC2_SSH_KEY` 異붽?

**Name:** `EC2_SSH_KEY`

**Value:** D-Live.pem ?뚯씪???댁슜 ?꾩껜瑜?蹂듭궗

```bash
# Mac/Linux?먯꽌 ?곕??먮줈 蹂듭궗
cat ~/Downloads/D-Live.pem | pbcopy

# ?먮뒗 ?먮뵒?곕줈 ?댁뼱???꾩껜 蹂듭궗
code ~/Downloads/D-Live.pem
```

?좑툘 **二쇱쓽:** `-----BEGIN RSA PRIVATE KEY-----`遺??`-----END RSA PRIVATE KEY-----`源뚯? ?꾩껜瑜?蹂듭궗?댁빞 ?⑸땲??

#### ??`EC2_HOST` 異붽?

**Name:** `EC2_HOST`

**Value:** `52.63.232.141`

#### ??`EC2_USERNAME` 異붽?

**Name:** `EC2_USERNAME`

**Value:** `ubuntu`

---

## ?뵎 2?④퀎: EC2?먯꽌 GitHub ?몄쬆 ?ㅼ젙 (git pull ?먮룞??

?꾩옱 EC2?먯꽌 `git pull` ???꾩씠??鍮꾨?踰덊샇瑜??낅젰?섍퀬 ?덉쑝誘濡? **Personal Access Token (PAT)** ?먮뒗 **SSH ??*濡??몄쬆???ㅼ젙?댁빞 ?⑸땲??

### 諛⑸쾿 1: Personal Access Token (沅뚯옣 - 媛꾨떒??

#### 2-1. GitHub?먯꽌 Personal Access Token ?앹꽦

1. GitHub ?묒냽 ???ㅻⅨ履????꾨줈???대┃ ??**Settings**
2. ?쇱そ 硫붾돱 留??꾨옒 **Developer settings** ?대┃
3. **Personal access tokens** ??**Tokens (classic)** ?대┃
4. **Generate new token** ??**Generate new token (classic)** ?대┃
5. ?ㅼ젙:
   - **Note:** `DLive EC2 Deploy`
   - **Expiration:** `No expiration` (?먮뒗 ?먰븯??湲곌컙)
   - **Select scopes:** ??**repo** (?꾩껜 泥댄겕)
6. **Generate token** ?대┃
7. ?뵶 **?앹꽦???좏겙??蹂듭궗?섏꽭??** (?ㅼ떆 蹂????놁뒿?덈떎)

?덉떆: `ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

#### 2-2. EC2?먯꽌 Git Credential ???

EC2??SSH ?묒냽 ??

```bash
ssh -i ~/Downloads/D-Live.pem ubuntu@52.63.232.141

# ?꾨줈?앺듃 ?붾젆?좊━濡??대룞
cd ~/dlive-cona-client

# Git credential helper ?ㅼ젙 (??踰덈쭔 ?섎㈃ ??
git config credential.helper store

# ??踰?pull 諛쏆쑝硫댁꽌 ?몄쬆 ?뺣낫 ???
git pull origin main
```

?꾩씠??鍮꾨?踰덊샇 ?낅젰李쎌씠 ?섏삤硫?
- **Username:** GitHub ?꾩씠??(?? `Jusang98`)
- **Password:** ?꾩뿉???앹꽦??Personal Access Token (?? `ghp_xxxx...`)

?댁젣遺??`git pull`????鍮꾨?踰덊샇瑜?臾살? ?딆뒿?덈떎!

### 諛⑸쾿 2: SSH ???ъ슜 (???덉쟾??

<details>
<summary>?대┃?섏뿬 SSH ???ㅼ젙 諛⑸쾿 蹂닿린</summary>

#### 2-1. EC2?먯꽌 SSH ???앹꽦

```bash
ssh -i ~/Downloads/D-Live.pem ubuntu@52.63.232.141

# SSH ???앹꽦 (?대찓?쇱? GitHub ?대찓?쇰줈)
ssh-keygen -t ed25519 -C "your_email@example.com"
# ?뷀꽣 3踰?(湲곕낯 寃쎈줈 ?ъ슜, 鍮꾨?踰덊샇 ?놁쓬)

# ?앹꽦??怨듦컻???뺤씤
cat ~/.ssh/id_ed25519.pub
```

#### 2-2. GitHub??怨듦컻???깅줉

1. ?꾩뿉??異쒕젰??怨듦컻???꾩껜 蹂듭궗 (`ssh-ed25519 AAA...`濡??쒖옉)
2. GitHub ?묒냽 ???꾨줈????**Settings** ??**SSH and GPG keys**
3. **New SSH key** ?대┃
4. **Title:** `EC2 DLive Server`
5. **Key:** 蹂듭궗??怨듦컻??遺숈뿬?ｊ린
6. **Add SSH key** ?대┃

#### 2-3. EC2?먯꽌 Git Remote瑜?SSH濡?蹂寃?

```bash
cd ~/dlive-cona-client

# ?꾩옱 remote ?뺤씤
git remote -v

# HTTPS瑜?SSH濡?蹂寃?
git remote set-url origin git@github.com:Jusang98/DLive-cona-front.git

# ?뺤씤
git remote -v

# ?뚯뒪??
git pull origin main
```

</details>

---

## ??3?④퀎: 諛고룷 ?뚯뒪??

### 3-1. 濡쒖뺄?먯꽌 肄붾뱶 ?섏젙 ??Push

```bash
cd /Users/hanseungsu/Desktop/poby/?쒕씪?대툕/dlive-json-api/mobile-cona-front

# ?묒? 蹂寃?(?? README ?섏젙)
echo "# Test Auto Deploy" >> README.md

# Git commit & push
git add .
git commit -m "test: GitHub Actions ?먮룞諛고룷 ?뚯뒪??
git push origin main
```

### 3-2. GitHub Actions 濡쒓렇 ?뺤씤

1. GitHub 由ы룷吏?좊━ ?섏씠吏 ?묒냽
2. **Actions** ???대┃
3. 諛⑷툑 ?ㅽ뻾??workflow ?대┃?섏뿬 濡쒓렇 ?뺤씤

### 3-3. EC2?먯꽌 諛고룷 ?뺤씤

```bash
ssh -i ~/Downloads/D-Live.pem ubuntu@52.63.232.141

# PM2 ?꾨줈?몄뒪 ?뺤씤
pm2 list

# 濡쒓렇 ?뺤씤
pm2 logs dlive --lines 50
```

---

## ?뵩 ?몃윭釉붿뒋??

### ??`Permission denied (publickey)` ?먮윭

**?먯씤:** EC2_SSH_KEY Secret???섎せ ?ㅼ젙??

**?닿껐:** D-Live.pem ?뚯씪 ?댁슜??**?꾩껜** 蹂듭궗?덈뒗吏 ?뺤씤 (以꾨컮轅??ы븿)

### ??`git pull` ???몄쬆 ?ㅽ뙣

**?먯씤:** EC2?먯꽌 GitHub ?몄쬆???ㅼ젙?섏? ?딆쓬

**?닿껐:** ??**2?④퀎** ?ㅼ떆 吏꾪뻾

### ??`pm2 restart dlive` ?ㅽ뙣

**?먯씤:** PM2 ?꾨줈?몄뒪 ?대쫫???ㅻ? ???덉쓬

**?닿껐:** EC2?먯꽌 `pm2 list` ?ㅽ뻾?섏뿬 ?꾨줈?몄뒪 ?대쫫 ?뺤씤 ??`.github/workflows/deploy.yml` ?섏젙

### ??鍮뚮뱶 ?ㅽ뙣

**?먯씤:** `npm install` ?먮뒗 `npm run build` 以??먮윭

**?닿껐:**
1. GitHub Actions 濡쒓렇?먯꽌 ?먮윭 硫붿떆吏 ?뺤씤
2. 濡쒖뺄?먯꽌 `npm run build` ?뚯뒪??
3. `package.json` ?섏〈???뺤씤

---

## ?뱤 諛고룷 ?뚮┝ (?좏깮?ы빆)

Slack, Discord, Email ?깆쑝濡?諛고룷 ?깃났/?ㅽ뙣 ?뚮┝??諛쏄퀬 ?띕떎硫?`.github/workflows/deploy.yml`???뚮┝ ?④퀎瑜?異붽??????덉뒿?덈떎.

?꾩슂?섎㈃ 留먯??댁＜?몄슂!

---

## ?렞 ?ㅼ쓬 ?④퀎

1. ??GitHub Secrets 3媛??깅줉
2. ??EC2?먯꽌 GitHub ?몄쬆 ?ㅼ젙 (Personal Access Token ?먮뒗 SSH ??
3. ???뚯뒪???몄떆?섏뿬 ?먮룞諛고룷 ?뺤씤

?ㅼ젙 ?꾨즺 ???욎쑝濡쒕뒗:
```bash
git push origin main
```
留??섎㈃ ?먮룞?쇰줈 EC2??諛고룷?⑸땲?? ??

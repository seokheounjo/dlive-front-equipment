---
description: EC2 ?쒕쾭??蹂寃쎌궗??諛고룷 諛?寃利?
---

# EC2 諛고룷 ?꾨줈?몄뒪

?꾩옱 蹂寃쎌궗??쓣 EC2 ?꾨줈?뺤뀡 ?쒕쾭??諛고룷?섍퀬 ?숈옉??寃利앺빀?덈떎.

## 諛고룷 ??泥댄겕由ъ뒪??

諛섎뱶???뺤씤:
- [ ] PR??main??merge?섏뿀?붽??
- [ ] 濡쒖뺄 鍮뚮뱶媛 ?깃났?덈뒗媛? (`npm run build`)
- [ ] TypeScript ?먮윭媛 ?녿뒗媛? (`npm run type-check`)
- [ ] Git status媛 源⑤걮?쒓?? (而ㅻ컠 ????蹂寃쎌궗???놁쓬)

## 諛고룷 ?쒖꽌

### Step 1: PR ?뺤씤 諛?濡쒖뺄 main ?낅뜲?댄듃

```bash
# GitHub?먯꽌 PR Merge ?뺤씤
# ??https://github.com/teemartbottle/dlive-cona-client/pulls

# 濡쒖뺄 main 釉뚮옖移??낅뜲?댄듃
git checkout main
git pull teamart main

# 理쒖떊 而ㅻ컠 ?뺤씤
git log --oneline -5
```

### Step 2: EC2 SSH ?묒냽

**?쒕쾭 ?뺣낫**:
- IP: 52.63.232.141
- User: ubuntu
- Directory: /home/ubuntu/dlive-cona-client
- PM2 Process: dlive

```bash
# SSH ?묒냽
ssh ubuntu@52.63.232.141

# ?먮뒗 ???뚯씪 ?ъ슜
ssh -i /path/to/ec2_key.pem ubuntu@52.63.232.141
```

### Step 3: 諛고룷 ?ㅽ겕由쏀듃 ?ㅽ뻾

```bash
# 諛고룷 ?붾젆?좊━濡??대룞
cd /home/ubuntu/dlive-cona-client

# ?꾩옱 釉뚮옖移??뺤씤
git branch
# ??* main

# 理쒖떊 肄붾뱶 媛?몄삤湲?
git pull origin main

# ?섏〈???낅뜲?댄듃 (package.json 蹂寃??쒕쭔)
npm install

# 鍮뚮뱶
npm run build

# PM2 ?ъ떆??
pm2 restart dlive

# 濡쒓렇 ?뺤씤
pm2 logs dlive --lines 20
```

**?먮룞???ㅽ겕由쏀듃** (?대? ?앹꽦??:
```bash
# /tmp/ec2_deploy.sh ?ㅽ뻾
bash /tmp/ec2_deploy.sh
```

### Step 4: 諛고룷 寃利?

#### 4-1. PM2 ?곹깭 ?뺤씤
```bash
pm2 status

# ?덉긽 異쒕젰:
# ?뚢??????р???????р??????????р???????р?????????
# ??id  ??name ??status  ??cpu  ??memory??
# ?쒋??????쇄???????쇄??????????쇄???????쇄?????????
# ??0   ??dlive??online  ??0%   ??50 MB ??
# ?붴??????닳???????닳??????????닳???????닳?????????

# ??status媛 errored ?먮뒗 stopped?대㈃ 臾몄젣!
```

#### 4-2. 濡쒓렇 ?뺤씤
```bash
# 理쒓렐 50以?濡쒓렇 ?뺤씤
pm2 logs dlive --lines 50

# ?ㅼ떆媛?濡쒓렇 (Ctrl+C濡?醫낅즺)
pm2 logs dlive

# ?먮윭 濡쒓렇留??뺤씤
pm2 logs dlive --err
```

**?뺤긽 濡쒓렇 ?덉떆**:
```
[2025-01-28 10:30:00] Express server listening on port 80
[2025-01-28 10:30:01] API proxy ready: /api ??58.143.140.222:8080
```

**?먮윭 濡쒓렇 ?덉떆**:
```
Error: Cannot find module 'express'
```

#### 4-3. ?ы듃 ?뺤씤
```bash
# 80踰??ы듃 LISTEN ?뺤씤
sudo netstat -tlnp | grep 80

# ?덉긽 異쒕젰:
# tcp6  0  0 :::80  :::*  LISTEN  12345/node
```

#### 4-4. cURL ?뚯뒪??
```bash
# 猷⑦듃 ?섏씠吏 ?뺤씤
curl -I http://52.63.232.141/

# ?덉긽: HTTP/1.1 200 OK

# API ?뚯뒪??
curl -X POST http://52.63.232.141/api/statistics/equipment/getEquipmentHistoryInfo \
  -H "Content-Type: application/json" \
  -d '{"EQT_SERNO":"TEST"}'

# ?덉긽: JSON ?묐떟 ?먮뒗 ?먮윭 硫붿떆吏
```

### Step 5: 釉뚮씪?곗? ?뚯뒪??

```
1. http://52.63.232.141/ ?묒냽
2. 濡쒓렇??(?먮뒗 Demo Mode ?쒖꽦??
3. 蹂寃쏀븳 湲곕뒫 ?뚯뒪??
   - ?λ퉬愿由?硫붾돱 ?대┃
   - ?대떦 湲곕뒫 ???좏깮
   - ?숈옉 ?뺤씤
4. 釉뚮씪?곗? 媛쒕컻???꾧뎄 ?뺤씤
   - Console???먮윭 ?놁쓬
   - Network ??뿉??API ?몄텧 ?깃났
```

**泥댄겕 ?ъ씤??*:
- ???섏씠吏 濡쒕뱶 ?깃났
- ??CSS ?ㅽ????뺤긽 ?곸슜
- ??API ?몄텧 ?깃났 (Network ??
- ??濡쒕뵫 ?ㅽ뵾???쒖떆
- ???곗씠???뺤긽 ?뚮뜑留?
- ???먮윭 泥섎━ ?숈옉

## 諛고룷 ?ㅽ뙣 ??濡ㅻ갚

### 諛⑸쾿 1: Git Rollback

```bash
# EC2 ?쒕쾭?먯꽌

# 理쒓렐 而ㅻ컠 ?뺤씤
git log --oneline -10

# ?댁쟾 而ㅻ컠?쇰줈 ?섎룎由ш린
git reset --hard <?댁쟾_而ㅻ컠_?댁떆>

# ?? git reset --hard abc1234

# ?щ퉴??& ?ъ떆??
npm run build
pm2 restart dlive
```

### 諛⑸쾿 2: PM2 Restart

```bash
# 媛꾨떒??臾몄젣???ъ떆?묒쑝濡??닿껐
pm2 restart dlive

# ?먮뒗 ?꾩쟾 ?ъ떆??
pm2 delete dlive
pm2 start ecosystem.config.js
```

### 諛⑸쾿 3: 鍮뚮뱶 ?뚯씪 蹂듭썝

```bash
# 鍮뚮뱶 ?뚯씪 諛깆뾽 (諛고룷 ?꾩뿉)
cp -r dist dist.backup

# 臾몄젣 諛쒖깮 ??蹂듭썝
rm -rf dist
mv dist.backup dist
pm2 restart dlive
```

## ?몃윭釉붿뒋??

### 臾몄젣 1: 鍮뚮뱶 ?ㅽ뙣

**利앹긽**:
```
npm ERR! Failed at the build script
```

**?닿껐**:
```bash
# node_modules ?ъ꽕移?
rm -rf node_modules package-lock.json
npm install

# ?ㅼ떆 鍮뚮뱶
npm run build
```

### 臾몄젣 2: PM2 ?꾨줈?몄뒪 以묒?

**利앹긽**:
```
pm2 status
# ??dlive: stopped
```

**?닿껐**:
```bash
# 濡쒓렇 ?뺤씤
pm2 logs dlive --lines 100

# ?ъ떆??
pm2 restart dlive

# ?ъ쟾?????섎㈃
pm2 delete dlive
cd /home/ubuntu/dlive-cona-client
pm2 start npm --name dlive -- start
```

### 臾몄젣 3: ?ы듃 異⑸룎

**利앹긽**:
```
Error: listen EADDRINUSE: address already in use :::80
```

**?닿껐**:
```bash
# 80踰??ы듃 ?ъ슜 ?꾨줈?몄뒪 ?뺤씤
sudo lsof -i :80

# PID ?뺤씤 ??醫낅즺
sudo kill -9 <PID>

# PM2 ?ъ떆??
pm2 restart dlive
```

### 臾몄젣 4: API ?꾨줉???먮윭

**利앹긽**:
```
Error: ECONNREFUSED 58.143.140.222:8080
```

**?닿껐**:
```bash
# Legacy ?쒕쾭 ping ?뚯뒪??
ping 58.143.140.222

# ?곌껐 ???섎㈃ Demo Mode ?ъ슜
# ?먮뒗 愿由ъ옄?먭쾶 Legacy ?쒕쾭 ?곹깭 ?뺤씤 ?붿껌
```

## PM2 ?좎슜??紐낅졊??

```bash
# ?ㅼ떆媛?紐⑤땲?곕쭅
pm2 monit

# ?곸꽭 ?뺣낫
pm2 show dlive

# 硫붾え由??ъ슜???뺤씤
pm2 list

# 濡쒓렇 珥덇린??
pm2 flush

# ?ъ떆??(?ㅼ슫????놁쓬)
pm2 reload dlive

# ?ъ떆??(媛뺤젣)
pm2 restart dlive

# 以묒?
pm2 stop dlive

# ??젣
pm2 delete dlive
```

## 諛고룷 ?꾨즺 泥댄겕由ъ뒪??

- [ ] PM2 ?곹깭: online
- [ ] 濡쒓렇: ?먮윭 ?놁쓬
- [ ] ?ы듃: 80 LISTEN
- [ ] cURL: 200 ?묐떟
- [ ] 釉뚮씪?곗?: ?섏씠吏 濡쒕뱶 ?깃났
- [ ] 湲곕뒫 ?뚯뒪?? ?뺤긽 ?숈옉
- [ ] Console ?먮윭: ?놁쓬
- [ ] Network API: ?깃났

## 異쒕젰 ?뺤떇

諛고룷 ?꾨즺 ???ㅼ쓬 ?뺣낫 異쒕젰:

```
?? EC2 諛고룷 ?꾨즺

???쒕쾭 ?뺣낫
- IP: 52.63.232.141
- Status: online
- Uptime: 2h 30m
- Memory: 45 MB / 1 GB

??諛고룷 ?댁슜
- Commit: abc1234 "feat: ?λ퉬 ?좊떦 API ?곕룞"
- Build Time: 45s
- Deploy Time: 2025-01-28 10:30:00

??寃利?寃곌낵
- PM2 Status: ??online
- Port 80: ??LISTEN
- API Health: ???뺤긽
- Browser Test: ???듦낵

?뙋 ?묒냽 URL: http://52.63.232.141/

?뱥 ?ㅼ쓬 ?묒뾽: <?덉쑝硫??쒖떆>
```

## 李멸퀬

- **諛고룷 ?ㅽ겕由쏀듃**: `/tmp/ec2_deploy.sh`
- **諛고룷 媛?대뱶**: `/tmp/pr_merge_guide.md`
- **PM2 ?ㅼ젙**: `ecosystem.config.js` (?덉쑝硫?
- **Nginx ?ㅼ젙**: `/etc/nginx/sites-available/default` (?덉쑝硫?
